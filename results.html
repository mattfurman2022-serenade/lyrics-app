<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Your Personalized Lyrics</title>

    <style>
      body {
        background: #0f172a;
        color: #e5e7eb;
        font-family: Arial, Helvetica, sans-serif;
        padding: 40px;
      }

      h1 {
        text-align: center;
        margin-bottom: 30px;
      }

      #lyrics {
        white-space: pre-wrap;
        line-height: 1.6;
        font-size: 18px;
        max-width: 700px;
        margin: auto;
      }

      #status {
        text-align: center;
        margin-top: 20px;
        color: #9ca3af;
      }
    </style>
  </head>

  <body>
    <h1>Your Personalized Lyrics</h1>

    <div id="status">Generating your song…</div>
    <div id="lyrics"></div>

    <script>
      // 1️⃣ READ VALUES FROM URL
      const params = new URLSearchParams(window.location.search);

      const songType = params.get("songType");
      const name = params.get("name");
      const memory = params.get("memory");
      const relationship = params.get("relationship");
      const miss = params.get("miss");

      if (!name || !memory) {
        document.getElementById("status").textContent =
          "Missing song details.";
        throw new Error("Missing URL parameters");
      }

      // 2️⃣ CALL CLOUDFLARE WORKER
      fetch("https://patient-hat-3eee.mattfurman-2022.workers.dev", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          songType,
          name,
          memory,
          relationship,
          miss
        }),
      })
        .then((res) => res.json())
        .then((data) => {
          document.getElementById("status").remove();
          document.getElementById("lyrics").textContent =
            data.lyrics || "Lyrics could not be generated.";
        })
        .catch((err) => {
          document.getElementById("status").textContent =
            "Lyrics failed to load.";
          console.error(err);
        });
    </script>
  </body>
</html>
